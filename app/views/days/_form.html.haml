= form_for(@day, html: { 'ng-controller' => 'DayCtrl' }) do |f|

  .form-group
    = f.label :date
    .input-group
      = f.date_field :date

  .form-group
    = f.label :headline
    .input-group
      = f.text_field :headline, class: 'form-control', 'ng-model' => 'headline', 'ng-init' => "headline='#{j @day.headline}'"
      %span.input-group-addon {{headline.length}}/100

  .form-group
    = f.label :summary
    = f.text_area :summary, style: 'display: none;'
    #epiceditor

  .form-group
    = f.label :impact
    = f.number_field :impact, min: 0, max: 10

  .metadata-container{'ng-controller' => 'MetadataCtrl', 'ng-init' => "metadata=#{@attributes}"}
    %h2
      Metadata
      %button{type: 'button', class: 'btn', 'ng-click' => 'metadata.push({})'} Add metadata
    .form-group{'ng-controller' => 'MDCtrl', 'ng-repeat' => 'md in metadata'}
      %label{for: "{{input_id('key_name')}}"} Key
      %input{'ng-model' => "md.key_name", id: "{{input_id('key_name')}}", name: "{{input_name('key_name')}}"}
      %br
      %label{for: "{{input_id('type')}}"} Type
      = select_tag(:type, options_for_select([:integer, :string, :boolean]),
        name: "{{input_name('type')}}", 'ng-model' => 'md.type', id: "{{input_id('type')}}")
      %br
      %label{for: "{{input_id('value')}}"} Value
      %span{'ng-switch' => '', 'on' => 'md.type'}
        - {'text' => 'string', 'number' => 'integer', 'checkbox' => 'boolean'}.each do |type, switch|
          %input{name: "{{input_name('value')}}", id: "{{input_id('value')}}", 'ng-model' => 'md.value', type: type, 'ng-switch-when' => switch}



  = f.submit 'Record Day', class: 'btn'

:javascript
  var editor = new EpicEditor({
    textarea: 'day_summary',
    basePath: '/epiceditor'
  }).load();
